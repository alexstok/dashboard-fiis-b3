name: Atualizar Dashboard de FIIs

on:
  schedule:
    # Executar 3 vezes ao dia (10h, 14h e 18h UTC-3)
    - cron: '0 13 * * 1-5'  # 10h BRT (dias úteis)
    - cron: '0 17 * * 1-5'  # 14h BRT (dias úteis)
    - cron: '0 21 * * 1-5'  # 18h BRT (dias úteis)
  workflow_dispatch:  # Permite execução manual

jobs:
  update-dashboard:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout do repositório
      uses: actions/checkout@v2
      
    - name: Configurar Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.9'
        
    - name: Instalar dependências
      run: |
        python -m pip install --upgrade pip
        pip install requests pandas matplotlib
        
    - name: Atualizar dados e gerar dashboard
      run: |
        python scripts/fetch_data.py
        python scripts/process_data.py
        python scripts/update_dashboard.py
        
    - name: Commit e push das alterações
      run: |
        git config --global user.name 'GitHub Actions'
        git config --global user.email 'actions@github.com'
        git add data/ index.html
        git commit -m "Atualização automática do dashboard [$(date +'%d/%m/%Y %H:%M')]" || echo "Sem alterações para commit"
        git push
